{{!-- Dark Sun Calendar Grid Widget Template --}}
<div class="calendar-grid-content">
    {{#if error}}
    <div class="error-state">
        <i class="fas fa-exclamation-triangle"></i>
        <span>{{error}}</span>
    </div>
    {{else}}
    {{!-- Calendar Header with Navigation --}}
    <div class="calendar-grid-header">
        <div class="navigation-controls">
            <div class="month-navigation">
                <button type="button" class="nav-button" data-action="previousMonth" title="Previous Month">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="month-info">
                    <div class="month-name">{{monthName}}</div>
                    {{#if monthDescription}}
                    <div class="month-description" title="{{monthDescription}}">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    {{/if}}
                </div>
                <button type="button" class="nav-button" data-action="nextMonth" title="Next Month">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <div class="year-navigation">
                <button type="button" class="nav-button" data-action="previousYear" title="Previous Year">
                    <i class="fas fa-angle-double-left"></i>
                </button>
                <button type="button" class="year-display clickable" data-action="setYear"
                    title="Click to set year">{{yearDisplay}}</button>
                <button type="button" class="nav-button" data-action="nextYear" title="Next Year">
                    <i class="fas fa-angle-double-right"></i>
                </button>
            </div>
        </div>

        <div class="header-actions">
            <button type="button" class="today-button" data-action="goToToday" title="Go to current date">
                <i class="fas fa-crosshairs"></i> Today
            </button>
        </div>
    </div>

    {{!-- Weekday Headers --}}
    <div class="weekday-headers" style="--weekday-count: {{weekdays.length}};">
        {{#each weekdays}}
        <div class="weekday-header" title="{{description}}">
            <span class="weekday-name">{{abbreviation}}</span>
        </div>
        {{/each}}
    </div>

    {{!-- Calendar Grid --}}
    <div class="calendar-grid" style="--weekday-count: {{weekdays.length}};">
        {{#each monthData.weeks}}
        <div class="calendar-week">
            {{#each this}}
            {{#if isEmpty}}
            <div class="calendar-day empty"></div>
            {{else}}
            <div class="calendar-day {{#if isToday}}today{{/if}} {{#if isViewDate}}view-date{{/if}} {{#if hasNotes}}has-notes {{primaryCategory}}{{/if}}"
                data-action="selectDate" data-day="{{day}}" data-date="{{date.year}}-{{date.month}}-{{date.day}}"
                data-category="{{primaryCategory}}"
                title="{{#if isToday}}Current Date: {{/if}}{{date.year}}-{{date.month}}-{{date.day}}{{#if hasNotes}} - {{noteCount}} note(s){{/if}} (Click to {{#if isGM}}set date{{else}}view details{{/if}})">
                <span class="day-number">{{day}}</span>
                {{#if hasNotes}}
                <button type="button" class="note-indicator" data-action="viewNotes" data-day="{{day}}"
                    title="{{noteCount}} note(s) - Click to view/edit">
                    {{#if (gt noteCount 1)}}
                    <span class="note-count {{primaryCategory}}">{{noteCount}}</span>
                    {{else}}
                    <i class="fas fa-sticky-note {{primaryCategory}}"></i>
                    {{/if}}
                </button>
                {{/if}}
                {{#if canCreateNote}}
                <button type="button" class="quick-note-btn" data-action="createNote" data-day="{{day}}"
                    title="Create note for this date">
                    <i class="fas fa-plus"></i>
                </button>
                {{/if}}
            </div>
            {{/if}}
            {{/each}}
        </div>
        {{/each}}
    </div>

    {{!-- Calendar Info Footer --}}
    <div class="calendar-grid-footer">
        {{#if isGM}}
        <div class="gm-instructions">
            <i class="fas fa-crown"></i>
            <span>{{uiHint}}</span>
        </div>
        {{else}}
        <div class="player-instructions">
            <i class="fas fa-eye"></i>
            <span>{{uiHint}}</span>
        </div>
        {{/if}}

        {{#if monthDescription}}
        <div class="month-description-full">
            <i class="fas fa-info-circle"></i>
            <span>{{monthDescription}}</span>
        </div>
        {{/if}}
    </div>
    {{/if}}
</div>